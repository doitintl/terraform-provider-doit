---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "doit_allocation Resource - terraform-provider-doit"
subcategory: ""
description: |-
  Define how costs are distributed across your organization.
---

# doit_allocation (Resource)

Define how costs are distributed across your organization.

## Example Usage

```terraform
# Create an allocation for the development environment based on a project label
resource "doit_allocation" "allocation_dev" {
  name        = "Dev"
  description = "Development Environment"
  rule = {
    formula = "A"
    components = [{
      mode   = "is"
      type   = "project_label"
      key    = "env"
      values = ["dev"]
    }]
  }
}

# Create an allocation for your dev GKE clusters in the US
resource "doit_allocation" "allocation_dev_clusters_us" {
  name        = "Dev Clusters US"
  description = "Development GKE Clusters in the US"
  rule = {
    formula = "A AND B"
    components = [
      {
        include_null = true
        mode         = "is"
        type         = "fixed"
        key          = "kubernetes_cluster_name"
        values       = ["dev"]
      },
      {
        key  = "country"
        mode = "is"
        type = "fixed"
        values = [
          "US",
        ]
      }
    ]
  }
}

# Create a group allocation that combines multiple rules.
# Group allocations use "rules" (plural) and require "unallocated_costs"
# to label costs that don't match any rule.
resource "doit_allocation" "allocation_by_region" {
  name              = "By Region"
  description       = "Group costs by region"
  unallocated_costs = "Other Regions"
  rules = [
    {
      action  = "create"
      name    = "US"
      formula = "A"
      components = [{
        key    = "country"
        mode   = "is"
        type   = "fixed"
        values = ["US"]
      }]
    },
    {
      action  = "create"
      name    = "Europe"
      formula = "A"
      components = [{
        key    = "country"
        mode   = "is"
        type   = "fixed"
        values = ["DE", "FR", "GB", "NL"]
      }]
    }
  ]
}

# ─────────────────────────────────────────────────────────────────────────────
# Discovering valid component values using data sources
# ─────────────────────────────────────────────────────────────────────────────
# Allocation components use `type` and `key` fields that correspond to dimension
# types and IDs. Use doit_dimensions to discover valid combinations.

data "doit_dimensions" "all" {}

# Build a lookup map from dimension ID to its type
locals {
  dimension_types = { for id, types in {
    for d in data.doit_dimensions.all.dimensions : d.id => d.type...
  } : id => types[0] }
}

# Use doit_products to discover valid service IDs for allocation components
data "doit_products" "gcp" {
  platform = "google_cloud_platform"
}

# Create an allocation scoped to GCP Compute Engine services using data sources
resource "doit_allocation" "gcp_compute" {
  name        = "GCP Compute"
  description = "GCP Compute Engine costs"
  rule = {
    formula = "A"
    components = [{
      mode   = "is"
      type   = local.dimension_types["service_description"]
      key    = "service_description"
      values = [for p in data.doit_products.gcp.products : p.id if p.display_name == "Compute Engine"]
    }]
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `description` (String) Allocation description.
- `name` (String) Allocation name.

### Optional

- `rule` (Attributes) Single allocation rule. (see [below for nested schema](#nestedatt--rule))
- `rules` (Attributes List) (see [below for nested schema](#nestedatt--rules))
- `unallocated_costs` (String) Custom label for values that do not fit into allocation (required for group type allocation).

### Read-Only

- `allocation_type` (String) Composition type of allocation.
- `anomaly_detection` (Boolean) Whether anomaly detection is enabled for this allocation.
- `create_time` (Number) The time when the allocation was created (in UNIX timestamp).
- `id` (String) ID of the new allocation.
- `type` (String) Type of the new allocation.
- `update_time` (Number) Last time the allocation was modified (in UNIX timestamp).

<a id="nestedatt--rule"></a>
### Nested Schema for `rule`

Required:

- `components` (Attributes List) List of allocation filter components. (see [below for nested schema](#nestedatt--rule--components))
- `formula` (String) Formula for combining components (A is the first component, B is the second one, etc.).

<a id="nestedatt--rule--components"></a>
### Nested Schema for `rule.components`

Required:

- `key` (String) Key of an existing dimension. Examples: "billing_account_id", "country".
- `mode` (String) Filter mode to apply.
Possible values: `is`, `starts_with`, `ends_with`, `contains`, `regexp`
- `type` (String) Enumeration of supported dimension/filter types.
Possible values: `datetime`, `fixed`, `optional`, `label`, `tag`, `project_label`, `system_label`, `attribution`, `attribution_group`, `gke`, `gke_label`
- `values` (List of String)

Optional:

- `include_null` (Boolean) Include null values.
- `inverse_selection` (Boolean) If true, all selected values will be excluded.



<a id="nestedatt--rules"></a>
### Nested Schema for `rules`

Required:

- `action` (String) Action to perform with this rule.
Possible values: `create`, `update`, `select`

Optional:

- `components` (Attributes List) List of allocation filter components (required for 'create' or 'update' action). (see [below for nested schema](#nestedatt--rules--components))
- `description` (String) Description of the allocation rule.
- `formula` (String) Formula for combining components (A is the first component, B is the second one, etc.)
- `id` (String) ID of existing allocation (required for 'update' or 'select' action).
- `name` (String) Name of the allocation rule.

<a id="nestedatt--rules--components"></a>
### Nested Schema for `rules.components`

Required:

- `key` (String) Key of an existing dimension. Examples: "billing_account_id", "country".
- `mode` (String) Filter mode to apply.
Possible values: `is`, `starts_with`, `ends_with`, `contains`, `regexp`
- `type` (String) Enumeration of supported dimension/filter types.
Possible values: `datetime`, `fixed`, `optional`, `label`, `tag`, `project_label`, `system_label`, `attribution`, `attribution_group`, `gke`, `gke_label`
- `values` (List of String)

Optional:

- `include_null` (Boolean) Include null values.
- `inverse_selection` (Boolean) If true, all selected values will be excluded.

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
terraform import doit_allocation.allocation [id]
```
